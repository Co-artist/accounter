# 统计页面功能实现计划

## 一、页面布局设计

### 1. 整体结构

* **顶部**：标题栏 + 筛选器（时间范围、交易类型）

* **中部**：数据汇总卡片（总收入、总支出、结余）

* **下部**：图表区域（按顺序排列饼图、柱状图、折线图）

### 2. 响应式设计

* 采用移动端优先设计

* 使用Flexbox和CSS Grid布局

* 图表区域在小屏幕下垂直排列，大屏幕下可考虑横向排列

* 确保图表容器高度自适应

## 二、组件结构设计

### 1. 主组件

* **StatisticsPage.vue**：统计页面主组件，整合所有子组件

### 2. 子组件

* **StatsHeader.vue**：页面标题和筛选器

* **StatsSummary.vue**：数据汇总卡片

* **StatsCharts.vue**：图表容器，包含三个图表组件

* **PieChart.vue**：消费类别占比饼图

* **BarChart.vue**：月度收支趋势柱状图

* **LineChart.vue**：收支变化曲线折线图

### 3. 工具函数

* **statsUtils.js**：数据处理和聚合的工具函数

## 三、数据处理逻辑

### 1. 数据加载与存储

* 从localStorage加载交易数据

* 实现数据缓存机制，避免重复计算

### 2. 时间维度聚合

* **日度聚合**：按日期分组，计算每日收支

* **周度聚合**：按周分组，计算每周收支

* **月度聚合**：按月份分组，计算每月收支

* **年度聚合**：按年份分组，计算每年收支

### 3. 分类维度聚合

* 按收入类别分组，计算各类别占比

* 按支出类别分组，计算各类别占比

### 4. 收支类型聚合

* 区分收入和支出，分别计算总额和趋势

## 四、图表实现方案

### 1. 饼图（消费类别占比）

* **使用场景**：展示支出或收入的类别占比

* **功能**：
  * 支持切换收入/支出视图
  * 悬停显示类别名称和金额
  * 支持点击下钻（可选）

* **技术实现**：
  ```javascript
  // 基于ECharts实现饼图
  const option = {
    tooltip: {
      trigger: 'item',
      formatter: '{b}: {c} ({d}%)'
    },
    series: [{
      type: 'pie',
      radius: '60%',
      data: categoryData,
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }]
  };
  ```

### 2. 柱状图（月度收支趋势）

* **使用场景**：展示不同月份的收入和支出对比

* **功能**：
  * 双Y轴设计，分别展示收入和支出
  * 悬停显示具体金额
  * 支持缩放和平移

* **技术实现**：
  ```javascript
  // 基于ECharts实现柱状图
  const option = {
    tooltip: {
      trigger: 'axis',
      axisPointer: { type: 'shadow' }
    },
    legend: { data: ['收入', '支出'] },
    xAxis: { type: 'category', data: months },
    yAxis: { type: 'value' },
    series: [
      { name: '收入', type: 'bar', data: incomeData },
      { name: '支出', type: 'bar', data: expenseData }
    ]
  };
  ```

### 3. 折线图（收支变化曲线）

* **使用场景**：展示收支随时间的变化趋势

* **功能**：
  * 双折线设计，分别展示收入和支出
  * 支持切换时间维度（日/周/月）
  * 悬停显示具体数据点
  * 支持缩放和平移

* **技术实现**：
  ```javascript
  // 基于ECharts实现折线图
  const option = {
    tooltip: { trigger: 'axis' },
    legend: { data: ['收入', '支出'] },
    xAxis: { type: 'category', data: timePoints },
    yAxis: { type: 'value' },
    series: [
      { name: '收入', type: 'line', data: incomeTrend },
      { name: '支出', type: 'line', data: expenseTrend }
    ]
  };
  ```

## 五、交互功能实现

### 1. 筛选器功能

* **时间范围筛选**：
  * 支持选择日、周、月、年
  * 支持自定义时间范围

* **交易类型筛选**：
  * 支持选择全部、收入、支出

* **分类筛选**：
  * 支持选择特定分类

### 2. 图表交互

* **悬停效果**：显示详细数据

* **缩放功能**：支持鼠标滚轮缩放

* **平移功能**：支持拖拽平移

* **数据下钻**：点击图表元素可查看更详细数据

### 3. 数据更新机制

* 实时监听localStorage数据变化

* 筛选条件变化时自动更新图表

* 支持手动刷新数据

## 六、异常处理机制

### 1. 数据加载状态

* 显示加载动画

* 加载完成后隐藏动画

### 2. 数据为空状态

* 显示友好提示信息

* 提供引导用户添加数据的入口

### 3. 错误处理

* 捕获并处理数据处理和图表渲染过程中的错误

* 显示错误提示

* 支持重试机制

## 七、实现步骤

1. **创建基础组件结构**

* 创建StatisticsPage.vue主组件

* 创建数据汇总卡片组件

* 创建图表容器组件

2. **实现数据处理逻辑**

* 创建statsUtils.js工具函数

* 实现时间维度聚合

* 实现分类维度聚合

3. **集成ECharts**

* 实现饼图组件

* 实现柱状图组件

* 实现折线图组件

4. **添加交互功能**

* 实现筛选器功能

* 添加图表交互效果

* 实现数据更新机制

5. **优化用户体验**

* 添加加载状态提示

* 添加数据为空提示

* 优化响应式设计

6. **测试与调试**

* 测试各种数据场景

* 测试不同屏幕尺寸

* 测试交互功能

* 调试性能问题

## 八、预期效果

1. **数据可视化**：通过多种图表直观展示财务数据

2. **多维度分析**：支持按时间、类别、收支类型进行分析

3. **流畅交互**：图表交互流畅，响应迅速

4. **良好体验**：数据加载状态清晰，错误提示友好

5. **响应式设计**：适配不同屏幕尺寸

通过以上实现，统计页面将提供全面的财务数据分析功能，帮助用户更好地了解自己的财务状况。