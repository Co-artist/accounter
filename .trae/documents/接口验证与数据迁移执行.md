## 先决条件
- 你已在 Supabase 执行完 `backend/supabase/migrations.sql`，并确认 `public.users` 等表已存在。
- 后端 `.env` 已设置：`SUPABASE_URL`、`SUPABASE_SERVICE_ROLE_KEY/anon key`、`JWT_SECRET`、`PORT`。
- 后端依赖已安装；如需我启动服务，会用 `npm run dev`。

## 步骤 1：连通性测试
- 在 `backend` 目录运行：
```
npm run test
```
- 预期输出：`Supabase connectivity ok`。若失败，检查 `.env` 与密钥生效。

## 步骤 2：接口验证（认证与反馈）
- 注册：
```
$registerBody = @{ username = 'demo_user'; password = 'Passw0rd!' } | ConvertTo-Json
Invoke-RestMethod -Uri http://localhost:5001/api/auth/register -Method Post -Body $registerBody -ContentType 'application/json'
```
- 登录并提取令牌：
```
$loginBody = @{ username = 'demo_user'; password = 'Passw0rd!' } | ConvertTo-Json
$loginRes = Invoke-RestMethod -Uri http://localhost:5001/api/auth/login -Method Post -Body $loginBody -ContentType 'application/json'
$token = $loginRes.token
```
- 提交反馈：
```
$fbBody = @{ type = 'bug'; content = '示例反馈'; contact = 'demo@example.com' } | ConvertTo-Json
Invoke-RestMethod -Uri http://localhost:5001/api/feedback -Method Post -Body $fbBody -ContentType 'application/json' -Headers @{ Authorization = "Bearer $token" }
```
- 获取当前用户反馈：
```
Invoke-RestMethod -Uri http://localhost:5001/api/feedback/user -Headers @{ Authorization = "Bearer $token" }
```
- 可选：获取当前用户信息：
```
Invoke-RestMethod -Uri http://localhost:5001/api/auth/me -Headers @{ Authorization = "Bearer $token" }
```

## 步骤 3：数据迁移（可选）
- 将 Mongo 导出 JSON 放入 `backend/migration_data/`：`users.json`、`transactions.json`、`categories.json`、`budgets.json`、`feedback.json`。
- 执行：
```
node ./scripts/migrate_from_mongo_to_supabase.mjs
```
- 校验：
```
-- 在 Supabase SQL 运行
select count(*) from public.users;
select count(*) from public.transactions;
select count(*) from public.categories;
select count(*) from public.budgets;
select count(*) from public.feedback;
```
- 抽样登录迁移后的用户并拉取 `/api/feedback/user` 验证数据可读。

## 步骤 4：问题排查
- `relation ... does not exist`：确认表是否在 `public` 模式下已创建；如未创建，重新执行迁移 SQL。
- 401/403：确认使用的密钥与是否启用 RLS；服务端建议用 `service_role key`。
- 500：查看后端日志 `logger.info/error` 输出与 Supabase 错误信息。

## 完成标识
- 连通性测试通过；认证与反馈接口返回预期；（可选）迁移脚本执行成功且数据量对齐。