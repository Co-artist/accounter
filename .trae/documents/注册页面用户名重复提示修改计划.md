# 注册页面用户名重复提示修改计划

## 1. 问题分析

### 现状
- 后端在用户名重复时返回英文错误信息：`Username already exists`
- 前端期望显示中文提示：`该用户名已被使用`
- 前端错误处理逻辑存在问题，无法正确匹配后端返回的英文错误信息

### 错误信息传递流程
1. 后端服务层抛出错误：`throw new Error('Username already exists')`
2. 后端控制器返回：`res.status(400).json({ message: error.message })`
3. 前端接收错误，但当前逻辑无法正确处理

## 2. 解决方案

### 修改前端错误处理逻辑
- 修改 `RegisterPage.vue` 中的 `handleRegister` 函数
- 确保能正确匹配后端返回的英文错误信息
- 显示用户期望的中文提示：`该用户名已被使用`

### 具体修改点

1. **修改 `handleRegister` 函数**：
   - 更新错误处理逻辑，匹配英文错误信息
   - 显示中文提示：`该用户名已被使用`

2. **确保错误样式正确**：
   - 错误信息已使用 `.error-message` 类
   - 该类已设置为红色，符合需求

## 3. 代码修改示例

```javascript
// 注册处理
const handleRegister = async () => {
  if (!validateForm()) return
  
  isLoading.value = true
  
  try {
    // 使用axios调用注册API
    const response = await axiosInstance.post('/auth/register', {
      username: form.value.username,
      password: form.value.password
    })
    
    // 保存token
    localStorage.setItem('token', response.token)
    localStorage.setItem('user', JSON.stringify(response))
    
    // 跳转到首页
    router.push('/')
  } catch (error) {
    console.error('注册失败:', error)
    // 修改错误处理逻辑
    if (error.response?.data?.message?.includes('Username already exists')) {
      errors.value.username = '该用户名已被使用'
    } else if (error.response?.data?.message) {
      errors.value.username = error.response.data.message
    } else {
      errors.value.username = '注册失败，请稍后重试'
    }
  } finally {
    isLoading.value = false
  }
}
```

## 4. 预期效果

- 当用户输入已存在的用户名时
- 页面会在用户名输入框下方显示红色文字提示：`该用户名已被使用`
- 提示清晰可见，符合用户期望

## 5. 测试方案

1. **手动测试**：
   - 打开注册页面
   - 输入已存在的用户名
   - 点击注册按钮
   - 验证是否显示红色提示文字

2. **自动化测试**（可选）：
   - 编写单元测试，模拟后端返回用户名重复错误
   - 验证前端是否正确显示中文提示

## 6. 风险评估

- **风险**：后端错误信息格式变化导致前端无法识别
- **规避**：使用更灵活的错误匹配方式

- **风险**：其他错误被误判为用户名重复
- **规避**：精确匹配错误信息

## 7. 实施步骤

1. 修改 `RegisterPage.vue` 中的 `handleRegister` 函数
2. 测试修改后的功能
3. 验证错误提示是否正确显示
4. 确保其他注册功能不受影响

## 8. 完成标准

- 用户名重复时显示红色文字提示：`该用户名已被使用`
- 提示位置正确，位于用户名输入框下方
- 其他注册流程正常
- 其他错误提示功能正常