# 反馈建议功能实现计划

## 1. 功能需求分析

用户需要一个反馈建议功能，包括：

* 反馈表单页面

* 提交反馈功能

* 反馈数据存储

* 查看反馈记录

## 2. 技术方案

### 2.1 前端实现

* 创建反馈建议页面

* 实现反馈表单

* 添加路由配置

* 实现提交反馈功能

### 2.2 后端实现

* 创建反馈模型

* 实现反馈API

* 实现反馈数据存储

* 提供查看反馈的方法

## 3. 具体实现步骤

### 3.1 前端实现

1. **创建反馈建议页面**：

   * 创建 `FeedbackPage.vue` 文件

   * 实现反馈表单UI

   * 添加表单验证

2. **表单字段**：

   * 反馈类型（选择）

   * 反馈内容（文本域）

   * 联系方式（可选）

   * 提交按钮

3. **路由配置**：

   * 在 `router/index.js` 中添加反馈页面路由

   * 配置路由守卫

4. **提交功能**：

   * 实现提交反馈的API调用

   * 添加提交成功提示

### 3.2 后端实现

1. **创建反馈模型**：

   * 创建 `Feedback` 模型

   * 定义字段：

     * type: 反馈类型

     * content: 反馈内容

     * contact: 联系方式

     * createdAt: 创建时间

     * userId: 用户ID

2. **实现反馈API**：

   * 创建反馈路由

   * 实现POST请求，接收反馈数据

   * 实现GET请求，获取反馈列表

3. **数据存储**：

   * 使用文件存储反馈数据

   * 或使用MongoDB存储

## 4. 代码实现

### 4.1 前端实现

#### 创建反馈页面 `FeedbackPage.vue`

```vue
<template>
  <div class="feedback-page">
    <h2 class="page-title">反馈建议</h2>
    
    <div class="feedback-form">
      <form @submit.prevent="handleSubmit">
        <!-- 反馈类型选择 -->
        <div class="form-group">
          <label for="feedback-type">反馈类型</label>
          <select id="feedback-type" v-model="feedback.type" required>
            <option value="">请选择反馈类型</option>
            <option value="bug">Bug报告</option>
            <option value="feature">功能建议</option>
            <option value="other">其他建议</option>
          </select>
        </div>

        <!-- 反馈内容 -->
        <div class="form-group">
          <label for="feedback-content">反馈内容</label>
          <textarea 
            id="feedback-content" 
            v-model="feedback.content" 
            rows="6" 
            placeholder="请详细描述您的反馈..." 
            required
          ></textarea>
        </div>

        <!-- 联系方式 -->
        <div class="form-group">
          <label for="feedback-contact">联系方式（可选）</label>
          <input 
            type="text" 
            id="feedback-contact" 
            v-model="feedback.contact"
            placeholder="邮箱或手机号"
          >
        </div>

        <!-- 提交按钮 -->
        <button type="submit" class="submit-btn" :disabled="submitting">
          {{ submitting ? '提交中...' : '提交反馈' }}
        </button>
      </form>
    </div>

    <!-- 反馈成功提示 -->
    <div v-if="showSuccess" class="success-message">
      ✅ 反馈提交成功！感谢您的支持！
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import axiosInstance from '../utils/axios'

const feedback = ref({
  type: '',
  content: '',
  contact: ''
})

const submitting = ref(false)
const showSuccess = ref(false)

const handleSubmit = async () => {
  submitting.value = true
  
  try {
    await axiosInstance.post('/api/feedback', feedback.value)
    showSuccess.value = true
    
    // 重置表单
    feedback.value = {
      type: '',
      content: '',
      contact: ''
    }
    
    // 3秒后隐藏成功提示
    setTimeout(() => {
      showSuccess.value = false
    }, 3000)
  } catch (error) {
    console.error('提交反馈失败:', error)
    alert('提交失败，请稍后重试')
  } finally {
    submitting.value = false
  }
}
</script>

<style scoped>
.feedback-page {
  padding: 20px;
}

.page-title {
  text-align: center;
  margin-bottom: 20px;
}

.feedback-form {
  max-width: 500px;
  margin: 0 auto;
}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
}

select, textarea, input {
  width: 100%;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
}

textarea {
  resize: vertical;
}

.submit-btn {
  width: 100%;
  padding: 14px;
  background-color: #667eea;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.submit-btn:hover:not(:disabled) {
  background-color: #5a67d2;
}

.submit-btn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.success-message {
  margin-top: 20px;
  text-align: center;
  color: #4caf50;
  font-weight: 500;
  padding: 12px 20px;
  background-color: rgba(76, 175, 80, 0.1);
  border-radius: 8px;
  margin: 20px auto;
  text-align: center;
}
</style>
```

#### 添加路由配置

在 `router/index.js` 中添加反馈页面路由：

```javascript
import FeedbackPage from '../views/FeedbackPage.vue'

const routes = [
  // 其他路由...
  {
    path: '/feedback',
    name: 'feedback',
    component: FeedbackPage,
    meta: { requiresAuth: true }
  }
]
```

### 3.2 后端实现

#### 创建反馈模型

在 `backend/database/models/Feedback.js` 中创建反馈模型：

```javascript
const mongoose = require('mongoose');

const FeedbackSchema = new mongoose.Schema({
  userId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  type: {
    type: String,
    enum: ['bug', 'feature', 'other'],
    required: true
  },
  content: {
    type: String,
    required: true
  },
  contact: {
    type: String,
    default: ''
  },
  createdAt: {
    type: Date,
    default: Date.now
  }
});

module.exports = mongoose.model('Feedback', FeedbackSchema);
```

#### 创建反馈API路由

在 `backend/routes/feedbackRoutes.js` 中创建反馈API：

```javascript
const express = require('express');
const router = express.Router();
const Feedback = require('../database/models/Feedback');
const authMiddleware = require('../middleware/authMiddleware');

// 提交反馈
router.post('/', authMiddleware, async (req, res) => {
  try {
    const { type, content, contact } = req.body;
    
    const feedback = new Feedback({
      userId: req.user.id,
      type,
      content,
      contact
    });
    
    await feedback.save();
    res.status(201).json({ message: '反馈提交成功' });
  } catch (error) {
    res.status(500).json({ message: '服务器错误' });
  }
});

// 获取反馈列表（管理员）
router.get('/', authMiddleware, async (req, res) => {
  try {
    const feedbacks = await Feedback.find().populate('userId', 'username');
    res.json(feedbacks);
  } catch (error) {
    res.status(500).json({ message: '服务器错误' });
  }
});

module.exports = router;
```

#### 配置反馈API

在 `backend/server.js` 中配置反馈API：

```javascript
const feedbackRoutes = require('./routes/feedbackRoutes');
app.use('/api/feedback', feedbackRoutes);
```

#### 创建反馈数据存储文件

创建 `backend/utils/feedbackStorage.js` 用于存储反馈数据：

```javascript
const fs = require('fs');
const path = require('path');

const feedbackFilePath = path.join(__dirname, '../data/feedback.json');

// 初始化反馈文件
if (!fs.existsSync(feedbackFilePath)) {
  fs.writeFileSync(feedbackFilePath, '[]');
}

// 获取所有反馈
const getAllFeedback = () => {
  const data = fs.readFileSync(feedbackFilePath, 'utf8');
  return JSON.parse(data);
};

// 添加反馈
const addFeedback = (feedback) => {
  const feedbacks = getAllFeedback();
  feedbacks.push({
    ...feedback,
    id: Date.now().toString(),
    createdAt: new Date().toISOString()
  });
  fs.writeFileSync(feedbackFilePath, JSON.stringify(feedbacks, null, 2));
};

module.exports = {
  getAllFeedback,
  addFeedback
};
```

## 4. 测试

1. 访问反馈页面
2. 填写反馈表单
3. 提交反馈
4. 检查反馈是否存储成功
5. 查看反馈记录

## 5. 预期效果

* 用户可以访问反馈页面

* 填写并提交反馈

* 看到提交成功提示

* 反馈数据被存储

* 管理员可以查看反馈记录

## 6. 扩展性

* 可以添加反馈状态管理

* 实现反馈回复功能

* 添加反馈统计

* 实现反馈导出功能

